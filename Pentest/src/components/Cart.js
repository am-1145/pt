import React, { useEffect, useState } from 'react';
import { useLocation, useNavigate } from 'react-router-dom';
import './Card.css'; // Assuming you use the same CSS file

const Cart = () => {
  const location = useLocation();
  const navigate = useNavigate();
  const [cart, setCart] = useState(location.state?.cart || []);

  useEffect(() => {
    const storedCart = localStorage.getItem('cart');
    if (storedCart) {
      setCart(JSON.parse(storedCart));
    }
  }, []);

  // Calculate the total amount
  const totalAmount = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);

  // Handle removing one item from the cart or decrementing the quantity
  const removeFromCart = (index) => {
    const updatedCart = [...cart];
    const product = updatedCart[index];

    if (product.quantity > 1) {
      updatedCart[index].quantity -= 1;  // Decrement quantity
    } else {
      updatedCart.splice(index, 1);  // Remove item if quantity is 1
    }

    setCart(updatedCart);
    localStorage.setItem('cart', JSON.stringify(updatedCart));
    navigate('/cart', { state: { cart: updatedCart } }); // Update the cart state
  };

  return (
    <div className="cart-container">
      <h2 className="section-heading">Your Cart</h2>
      {cart.length > 0 ? (
        <div>
          {/* Flex container to align cards side by side */}
          <div style={{ display: 'flex', flexWrap: 'wrap', gap: '20px' }}>
            {cart.map((item, index) => (
              <div className="product-card cart-item" key={index}
                style={{
                  width: '300px',
                  height: '550px',
                  objectFit: 'contain',
                  borderRadius: '4px',
                }}>
                <img src={item.image} alt={item.title} style={{
                  width: '300px',
                  height: '300px',
                  objectFit: 'contain',
                  borderRadius: '4px',
                }} />
                <div className="product-info">
                  <h3 className="product-title">{item.title}</h3>
                  <p className="product-price">₹{item.price}</p>
                  <p className="product-quantity">Quantity: {item.quantity}</p>
                  <p className="product-total">Total: ₹{item.price * item.quantity}</p>
                  <button onClick={() => removeFromCart(index)} className="remove-button">Remove</button>
                </div>
              </div>
            ))}
          </div>
          <h3>Total Amount: ₹{totalAmount}</h3>
          <button className="checkout-button">Checkout</button>
        </div>
      ) : (
        <p>Your cart is empty.</p>
      )}
    </div>
  );
};

export default Cart;
